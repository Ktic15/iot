{% extends "layout.html" %}
{% block body %}
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/bootstrap.min.css') }}">
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/app.css') }}">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/css/bootstrap-select.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.1/js/bootstrap-select.js"></script>

<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>-->
<!--<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->

<nav class="navbar navbar-expand-lg navbar-dark bg-dark nav-up">
    <div class="collapse navbar-collapse nav-border-remove" id="navbarNavDropdown">
        <ul class="navbar-nav">
            <li class="nav-item active">
                <a class="nav-link" href="/report">Report Generation<span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/hourly_report">Hourly Report</a>
            </li>
        </ul>
    </div>
</nav>

<div class="row">
    <div class="col-lg-3">

        <div class="card card-body">
            <form action="/employees_report" method="POST">
                <h2> Set Filter </h2>

                <div class="form-group">
                    <label>Operator id:</label><br>
                    <select id="employeeCode" data-live-search="true" class="selectpicker" class="form-control" name='employeeCode' required>
                        <option value="all" > ALL </option>
                        {% for item in employeesItem %}
                            <option value="{{ item.employee_code }}" >{{ item.employee_code }} / {{ item.employee_name}} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Machine id:</label><br>
                    <select id="machineCode" data-live-search="true" class="selectpicker"  name='machineCode' class="form-control" required>
                        <option value="all" > ALL </option>
                        {% for item in machinesItem %}
                        <option value="{{ item.mno }}" >{{ item.mno }} / {{ item.mname}} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Tool id:</label><br>
                    <select id="toolCode" data-live-search="true" class="selectpicker"  name='toolCode' class="form-control" required>
                        <option value="all" > ALL </option>
                        {% for item in toolItem %}
                        <option value="{{ item.tno }}" >{{ item.tno }} / {{ item.tname}} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Supervisor id:</label><br>
                    <select id="supervisorCode" data-live-search="true" class="selectpicker"  name='supervisorCode' class="form-control" required>
                        <option value="all" > ALL </option>
                        {% for item in supervisorsItem %}
                        <option value="{{ item.employee_code }}" >{{ item.employee_code }} / {{ item.employee_name}} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>Part id:</label><br>
                    <select id="partCode" data-live-search="true" class="selectpicker" name='partCode' class="form-control" required>
                        <option value="all" > ALL </option>
                        {% for item in partsItem %}
                        <option value="{{ item.pcode }}" >{{ item.pcode }} / {{ item.pdes}} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label>From Date:</label>
                    <input type="date" id="fromDate" name="fromDate"class="form-control" required>
                </div>
                <div class="form-group">
                    <label>To Date:</label>
                    <input type="date" id="toDate" name="toDate"class="form-control" required>
                </div>
                <div class="form-group">
                    <label>Shift:</label>
                    <select id="shiftCode" name="shiftCode"class="form-control" required>
                        <option value="all" > ALL </option>
                        {% for item in shiftItem %}
                            <option value="{{ item.scode }}" >{{ item.scode }} </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <input type="checkbox" id="show_not_assigned_data" name="show_not_assigned_data" value="yes">
                    <label for="show_not_assigned_data">Show Not Assigned data</label>
                </div>
<!--                {%if list_data!=[] %}-->
<!--                    <div class="form-group">-->
<!--                        <label>Export as PDF: </label>-->
<!--                        <input id="export_pdf" name="export_pdf" type="checkbox">-->
<!--                    </div>-->
<!--                {%endif%}-->
                <button class="btn btn-primary btn-block" name="save">
                    Generate Report
                </button>
                <button class="btn btn-primary btn-block" name="export" onclick="exportCheck()">
                    export as excel
                </button>
                <button class="btn btn-primary btn-block" name="export as pdf" onclick="createPDF()">
                    export as pdf
                </button>
                <button class="btn btn-primary btn-block" name="reset" onclick="exportReset()">
                    reset
                </button>
                <br>
                <br>
            </form>

        </div>
    </div>
    <div id="tab" class="col-md-8">
        <table id="dtable" class="table table-striped table-bordered" style="width:100%">
            <thead>
            <tr>
                <td>Sno</td>
                {% for row in columns %}
                <td>{{row}}</td>
                {% endfor %}
            </tr>
            </thead>
            <tbody>
            {% for rows in list_data %}
            {% set outer_loop = loop.index %}
            <tr>
                <td>{{loop.index}}</td>
                {% for row in rows %}
                    {%if row == None%}
                        <td>None</td>
                    {%elif loop.index==efficiency_column and list_data_length-extra_bottom_data>=outer_loop%}
                        <td>
                            {{row}}
                            {% set efficiency = row %}
                            {%if part_master_tolorance_data!=[] and part_master_tolorance_data[outer_loop-1][0]!=None%}
                                {% set efficiency_tolarance = part_master_tolorance_data[outer_loop-1][0] %}
                                <div id="efficiency_color" class="efficiency_color efficiency_color_dashboard" style="background-color:{%if efficiency>100-efficiency_tolarance and efficiency<100+efficiency_tolarance %} #f39c12 {%elif efficiency<=100-efficiency_tolarance%} red {%elif efficiency>=100+efficiency_tolarance%} #27ae60 {%endif%};"> </div>
                            {%endif%}
                        </td>
                    {%else%}
                        <td>{{row}}</td>
                    {%endif%}
                {% endfor %}
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
</div>
<script>
var status = '{{status}}';
if (status!=""){
    alert(status);
}

'{% for name,value in userInput.items() %}'
    console.log('{{name}}:{{value}}');
   document.getElementById('{{name}}').value='{{value}}';
'{% endfor %}'

'{% if userInput_checkbox %}'
    document.getElementById("show_not_assigned_data").checked = true;
'{% endif %}'
function exportCheck(){
    if ('{{list_data}}'=='[]'){
        event.preventDefault();
        alert("No date to export. Please generate the report");
    }
}

function exportReset(){
    if(!confirm("Are you sure to reset. All the generated data will lost")){
        event.preventDefault();
    }
}
   $(document).ready(function() {
      $( '#nav-header' ).find( 'li.active' ).removeClass( 'active' );
      $('#nav_report').addClass( 'active' );
    });
</script>
<script>
    function createPDF() {
        event.preventDefault();
        if ('{{list_data}}'=='[]'){
            alert("No date to export. Please generate the report");
            return;
        }
        var sTable = document.getElementById('dtable').innerHTML;
        var style = "<style>";
        style = style + "table {width: 100%;font: 17px Calibri;}";
        style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
        style = style + "padding: 2px 3px;text-align: center;}";
        style = style + "</style>";

        // CREATE A WINDOW OBJECT.
        var win = window.open('', '', 'height=700,width=700');

        win.document.write('<html><head>');
        win.document.write('<title>AVO Carbon report </title>');   // <title> FOR PDF HEADER.
        win.document.write(style);
        win.document.write('</head>');

        win.document.write('<body>');
        win.document.write('<table>'+sTable+'</table>');         // THE TABLE CONTENTS INSIDE THE BODY TAG.
        win.document.write('</body></html>');

        win.document.close(); 	// CLOSE THE CURRENT WINDOW.

        win.print();    // PRINT THE CONTENTS.
         alert("export success");
    }
</script>

{% endblock %}